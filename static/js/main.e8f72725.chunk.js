(this["webpackJsonpBasilisk-crowdloan-ui"]=this["webpackJsonpBasilisk-crowdloan-ui"]||[]).push([[0],{104:function(e,t){},135:function(e,t,a){},136:function(e,t,a){},137:function(e,t){},143:function(e,t){},144:function(e,t,a){},148:function(e,t,a){},149:function(e,t,a){},150:function(e,t,a){"use strict";a.r(t);var n=a(5),c=a.n(n),o=a(95),i=a.n(o),r=(a(135),a(178)),l=(a(136),a(181)),s=a(184),d=a(9),u=a.n(d),b=a(36),j=a.n(b),h=a(77),v=a.n(h);var m={processorUrl:"https://api-crowdloan.hydradx.io/graphql",nodeUrl:"wss://polka-arch-02.hydration.cloud",oracle:{dotToUSD:"25",hdxToUSD:new u.a("0.08059").dividedBy("3")},ownParaId:"2034",incentive:{opportunityCost:"0.2996",reimbursmentRange:{from:.1,to:1},leadPercentageCliff:{from:15,to:25},defaultDillutionMultiplier:"1",minimalDillutionMultiplier:"0.4483199822",allocatedHDXSupply:new u.a("1000000000").multipliedBy(new u.a(10).pow(12)).toFixed(0)}};const g=v()([m.incentive.leadPercentageCliff.from,m.incentive.leadPercentageCliff.to],[m.incentive.reimbursmentRange.from,m.incentive.reimbursmentRange.to],!0),O=e=>new u.a(m.incentive.reimbursmentRange.from).plus(m.incentive.reimbursmentRange.to).minus(g(e)),w=e=>{let{contributionAmount:t,reimbursmentMultiplier:a}=e;const n=new u.a(t).multipliedBy(m.oracle.dotToUSD).multipliedBy(m.incentive.opportunityCost),c=n.multipliedBy(a),o=c.dividedBy(m.oracle.hdxToUSD);return j.a.debug("calculateContributionReward",{opportunityCostUSD:n.toFixed(3),reimbursedOpportunityCostUSD:c.toFixed(3),rewardHDXAmount:o.toFixed(3)}),o},f=e=>{let{contributionReward:t,dillutionMultiplier:a}=e;return t.multipliedBy(a)},p=e=>{let{contributionAmount:t,leadPercentageRate:a}=e;const n=O(a);return w({contributionAmount:t,reimbursmentMultiplier:n})},_=e=>{let{contributionReward:t,totalRewardsDistributed:a}=e;const n=(e=>new u.a(e).gt(m.incentive.allocatedHDXSupply)?new u.a(m.incentive.allocatedHDXSupply).dividedBy(e):new u.a(m.incentive.defaultDillutionMultiplier))(a);return j.a.debug("calculateCurrentDillutedContributionReward","dillutionMultiplier",n.toString()),f({contributionReward:t,dillutionMultiplier:n})},x=e=>{const t=new u.a(m.incentive.minimalDillutionMultiplier);return f({contributionReward:e,dillutionMultiplier:t})};var S=a(172),y=a(56),A=a(183),N=a(179),C=a(41);const[D,F]=Object(C.a)((()=>{const[e,t]=Object(n.useState)();return Object(n.useEffect)((()=>{(async()=>{const e=new A.a(m.nodeUrl),a=await N.a.create({provider:e});t(a)})()}),[t]),e})),R=()=>{const e=F(),[t,a]=Object(n.useState)();return Object(n.useEffect)((()=>{null===e||void 0===e||e.rpc.chain.subscribeNewHeads((e=>{const t=e.number.toString();a(t)}))}),[e]),t},[k,P]=Object(C.a)(R);var I=a(169),L=a(113);const[T,B]=Object(C.a)((()=>{const[e,t]=Object(S.a)("hdx-crowdloan-account"),[a,c]=Object(n.useState)([]),o=F(),[i,r]=Object(n.useState)(!1),l=P(),[s,d]=Object(n.useState)(!1),u=Object(n.useCallback)((()=>{o&&(async()=>{r(!0),await Object(y.b)("hydra-crowdloan");const e=(await Object(y.a)()).map((e=>({address:Object(I.a)(Object(L.a)(e.address),0),name:e.meta.name}))),t=(await o.query.system.account.multi(e.map((e=>e.address)))).map(((t,a)=>({...e[a],balance:t.data.free.toString()})));c(t),r(!1),d(!0)})()}),[c,r,o,d]);return Object(n.useEffect)((()=>{e&&u()}),[e,u,l]),{activeAccountAddress:e,setActiveAccountAddress:t,getAllAccounts:u,allAccounts:a,loading:i,initiallyLoaded:s}}));j.a.setLevel("DEBUG");const E=l.a`
    query AccountData($accountId: String!) {
        contributions(where: {account: {accountId_eq: $accountId}}){
            balance
            contributionReward
        }
    }
`,M=l.a`
    query InitialData($ownParaId: ID!) {
        incentive: incentiveById(id: "incentive") {
            totalRewardsDistributed
            leadPercentageRate
            blockHeight,
            siblingParachain {
                id
            }
        }

        # TODO: add fetching only of 3 days old data using the block height filter
        ownParachain: parachainById(id: $ownParaId) {
            fundsPledged,
            # TODO: add createdAt for graph
        }
    }
`,U=l.a`
    query SiblingData($siblingParaId: ID!) {
        # TODO: add fetching only of 3 days old data using the block height filter
        siblingParachain: parachainById(id: $siblingParaId) {
            fundsPledged,
        }
    }
`;var H=a(173);a(144);const X=e=>new u.a(e).dividedBy(new u.a(10).pow(10)).toFixed(10);var q=a(26),G=a.n(q),$=a(7);const J=e=>{let{account:t,activeAccountLoading:a,initiallyLoaded:c,accounts:o,setActiveAccountAddress:i,chainBlockHeight:r,processorBlockHeight:l,getAllAccounts:s,apiReady:d,showAccountSelector:u,setShowAccountSelector:b}=e;const j=Object(n.useRef)(null);Object(n.useEffect)((()=>{u&&(console.log("loading accounts"),s())}),[u,s]),Object(H.a)(j,(()=>b(!1)));const h=Object(n.useCallback)((e=>{i(e.address),b(!1)}),[i,b]);return Object($.jsxs)("div",{className:"accountSelector",children:[Object($.jsx)("div",{ref:j,className:"accountSelector__overlay"+(u?"":" hidden"),children:null!==o&&void 0!==o&&o.length?Object($.jsx)("div",{className:"accountSelector__overlay__list",children:o.map(((e,t)=>Object($.jsxs)("div",{className:"accountSelector__account",onClick:t=>h(e),children:[Object($.jsx)("div",{className:"accountSelector__account__name",children:e.name}),"|",Object($.jsxs)("div",{className:"accountSelector__account__balance",children:[G()(parseFloat(X(e.balance)))," DOT"]}),"|",Object($.jsx)("div",{className:"accountSelector__account__address",children:e.address})]},t)))}):Object($.jsx)("div",{className:"accountSelector__overlay__list__empty",children:"No accounts available"})}),Object($.jsx)("div",{className:"accountSelector__accountInfo",children:Object($.jsxs)("div",{className:"accountSelector__account account_selector__accountInfo__info",onClick:e=>b(!0),children:["[",d?t?Object($.jsxs)($.Fragment,{children:[Object($.jsx)("div",{className:"accountSelector__account__name",children:null===t||void 0===t?void 0:t.name}),"|",Object($.jsxs)("div",{className:"accountSelector__account__balance",children:[G()(parseFloat(X(null===t||void 0===t?void 0:t.balance)))," DOT"]}),"|",Object($.jsx)("div",{className:"accountSelector__account__address",children:null===t||void 0===t?void 0:t.address})]}):"Connect account":Object($.jsx)("div",{className:"accountSelector__account__name",children:"Loading..."}),"]"]})})]})};var Y=a(107);a(148);var z=a(82),Q=a(108),W=a.n(Q),Z=a(109),K=a.n(Z);let V;!function(e){e[e.NOT_SENT=0]="NOT_SENT",e[e.LOADING=1]="LOADING",e[e.SUCCESSFUL=2]="SUCCESSFUL",e[e.FAILED=3]="FAILED"}(V||(V={}));const ee=()=>{const e=F(),{activeAccountAddress:t}=B(),[a,c]=Object(n.useState)(V.NOT_SENT),o=Object(n.useCallback)((a=>{e&&t&&(c(V.LOADING),(async()=>{try{const{signer:o}=await Object(y.c)(t);await e.tx.crowdloan.contribute(m.ownParaId,(n=a.amount,new u.a(n).multipliedBy(new u.a(10).pow(10)).toFixed(0)),null).signAndSend(t,{signer:o},(t=>{let{status:a,events:n}=t;(a.isInBlock||a.isFinalized)&&(n.filter((t=>{let{event:a}=t;return e.events.system.ExtrinsicFailed.is(a)})).length?c(V.FAILED):c(V.SUCCESSFUL))}))}catch(o){console.log("failed"),console.error("contribution failed",o),c(V.FAILED)}var n})())}),[e,t]);return console.log("contributionStatus",a),{handleCrowdloanContribute:o,contributionStatus:a}},te=K()({prefix:"",suffix:"",includeThousandsSeparator:!0,thousandsSeparatorSymbol:" ",allowDecimal:!0,decimalSymbol:".",decimalLimit:3,integerLimit:10,allowNegative:!1,allowLeadingZeroes:!1}),ae=e=>{let{totalContributionAmount:t,totalRewards:a,onContribute:c,apiReady:o,activeAccount:i,setShowAccountSelector:r,contributionStatus:l,incentive:s}=e;const d=Object(z.b)(),[b,j]=Object(n.useState)({current:"0",minimal:"0"}),h=d.watch("amount");Object(n.useEffect)((()=>{s&&j({current:_({contributionReward:p({contributionAmount:h||"0",leadPercentageRate:new u.a(null===s||void 0===s?void 0:s.leadPercentageRate).dividedBy(new u.a(10).pow(6)).toNumber()}),totalRewardsDistributed:s.totalRewardsDistributed}).toFixed(6),minimal:x(p({contributionAmount:h||"0",leadPercentageRate:new u.a(null===s||void 0===s?void 0:s.leadPercentageRate).dividedBy(new u.a(10).pow(6)).toNumber()})).toFixed(6)})}),[h,s]);const v=Object(n.useCallback)((e=>{i?c(e):r(!0)}),[i,r,c]);return Object($.jsxs)("div",{className:"contribute",children:[Object($.jsx)("h2",{children:"Contribute"}),Object($.jsxs)("div",{className:"contribute__past",children:[Object($.jsxs)("div",{children:["Your contribution: ",t&&G()(parseFloat(X(t.toFixed(0))))," DOT"]}),Object($.jsxs)("div",{children:["Your minimum rewards: ",(null===a||void 0===a?void 0:a.totalMinimalRewards)&&G()(parseFloat((m=null===a||void 0===a?void 0:a.totalMinimalRewards.toFixed(0),new u.a(m).dividedBy(new u.a(10).pow(12)).toFixed(12))))," HDX"]})]}),Object($.jsxs)("div",{className:"contribute__current",children:[Object($.jsxs)("div",{children:["Current rewards: ",G()(parseFloat(b.current))," HDX"]}),Object($.jsxs)("div",{children:["Minimum rewards: ",G()(parseFloat(b.minimal))," HDX"]})]}),Object($.jsx)("div",{children:Object($.jsxs)("form",{className:"contribute__form",onSubmit:d.handleSubmit(v),children:[Object($.jsx)(z.a,{control:d.control,name:"amount",rules:{validate:e=>e&&parseFloat(e.replaceAll(" ",""))>=5},render:e=>{let{field:t}=e;return Object($.jsx)(W.a,{mask:te,autoComplete:"off",placeholder:"100 000",disabled:!0,...t,onChange:e=>{const a=e.target.value.replaceAll(" ","");t.onChange(a),d.trigger("amount")}})}}),Object($.jsx)("button",{type:"submit",disabled:!0,children:"Crowdloan finished"}),Object($.jsxs)("div",{className:"status",children:[d.formState.errors.amount?Object($.jsx)("div",{className:"status__info",children:"Minimal contribution is 5 DOT"}):Object($.jsx)($.Fragment,{}),(()=>{switch(l){case V.FAILED:return Object($.jsx)("div",{className:"status__error",children:"Contribution failed"});case V.SUCCESSFUL:return Object($.jsx)("div",{className:"status__info",children:"Contribution successful, your rewards are being processed and will show up momentarily."});case V.LOADING:return Object($.jsx)("div",{className:"status__info",children:"Contribution loading"});default:return""}})()]})]})})]});var m};a(149);const ne=()=>{var e;const t=R(),a=F(),{activeAccount:c,loading:o,setActiveAccountAddress:i}=(()=>{const{activeAccountAddress:e,allAccounts:t,getAllAccounts:a,loading:c,setActiveAccountAddress:o}=B();return Object(n.useEffect)((()=>{e&&a()}),[e,a]),{activeAccount:Object(n.useMemo)((()=>Object(Y.find)(t,{address:e})),[e,t]),loading:c,setActiveAccountAddress:o}})(),{getAllAccounts:r,allAccounts:l,loading:d,initiallyLoaded:b}=B(),{loading:j,incentive:h,ownParachain:v}=(()=>{const e=P(),[t,{data:a,loading:c,networkStatus:o,refetch:i}]=Object(s.a)(M,{notifyOnNetworkStatusChange:!0,variables:{ownParaId:m.ownParaId},nextFetchPolicy:"no-cache"});return Object(n.useEffect)((()=>{console.log("refetching",e),e&&(i?i():t())}),[e,t,i]),{...a,loading:c,networkStatus:o}})(),{loading:g,contributions:w,accountTotalRewards:f,accountTotalContribution:p}=(e=>{const{activeAccountAddress:t}=B(),a=P(),[c,{data:o,loading:i,networkStatus:r,refetch:l}]=Object(s.a)(E,{notifyOnNetworkStatusChange:!0,nextFetchPolicy:"no-cache",variables:{accountId:t}}),d=Object(n.useMemo)((()=>{var t;if(!e||!o)return;const a=null===(t=o.contributions)||void 0===t?void 0:t.reduce(((e,t)=>e.plus(t.contributionReward)),new u.a(0));return a?{totalDillutedRewards:_({contributionReward:new u.a(a.toString()),totalRewardsDistributed:e}),totalMinimalRewards:x(a)}:void 0}),[o,e]),b=Object(n.useMemo)((()=>{var e;return null===o||void 0===o||null===(e=o.contributions)||void 0===e?void 0:e.reduce(((e,t)=>e.plus(t.balance)),new u.a(0))}),[o]);return Object(n.useEffect)((()=>{if(!t)return;const e={variables:{accountId:t}};console.log("active account address changed",e),l?l(e):c(e)}),[t,c,l,a]),{...o,accountTotalRewards:d,accountTotalContribution:b,loading:i,networkStatus:r}})(null===h||void 0===h?void 0:h.totalRewardsDistributed),{handleCrowdloanContribute:S,contributionStatus:y}=ee(),[A,N]=Object(n.useState)(!1),{loading:C,siblingParachain:D}=(e=>{const t=P(),[a,{data:c,loading:o,networkStatus:i}]=Object(s.a)(U,{notifyOnNetworkStatusChange:!0,nextFetchPolicy:"no-cache"});return Object(n.useEffect)((()=>{e&&a({variables:{siblingParaId:e}})}),[t,a,e]),{...c,loading:o,networkStatus:i}})(null===h||void 0===h||null===(e=h.siblingParachain)||void 0===e?void 0:e.id),k=(Object(n.useMemo)((()=>{if(h)return O(new u.a(null===h||void 0===h?void 0:h.leadPercentageRate).dividedBy(new u.a(10).pow(6)).toNumber()).toFixed(2)}),[h]),Object(n.useCallback)((()=>null!==D&&void 0!==D&&D.fundsPledged&&null!==v&&void 0!==v&&v.fundsPledged?(100/parseFloat(X(null===D||void 0===D?void 0:D.fundsPledged))*parseFloat(X(null===v||void 0===v?void 0:v.fundsPledged))).toFixed(2):"0"),[null===D||void 0===D?void 0:D.fundsPledged,null===v||void 0===v?void 0:v.fundsPledged]));return Object($.jsxs)("div",{className:"screen",children:[Object($.jsxs)("div",{className:"screen__navigation",children:[Object($.jsxs)("a",{href:"https://hydradx.io",rel:"noreferrer",target:"_blank",children:[Object($.jsx)("div",{className:"hydraLogo screen__navigation__icon"}),Object($.jsx)("h1",{children:"Home"})]}),Object($.jsx)("a",{className:"help",href:"https://discord.gg/aQTtp8aRbk",rel:"noreferrer",target:"_blank",children:"Help"}),Object($.jsx)("a",{className:"help",href:"https://docs.hydradx.io/hydradx_crowdloan",rel:"noreferrer",target:"_blank",children:"Docs"})]}),Object($.jsxs)("div",{className:"dashboard",children:[Object($.jsx)("div",{className:"dashboard__top",children:Object($.jsx)(J,{account:c,accounts:l,getAllAccounts:r,activeAccountLoading:o,initiallyLoaded:b,setActiveAccountAddress:i,chainBlockHeight:t,processorBlockHeight:null===h||void 0===h?void 0:h.blockHeight,apiReady:!!a,showAccountSelector:A,setShowAccountSelector:N})}),Object($.jsxs)("div",{className:"dashboard__bottom",children:[Object($.jsxs)("div",{className:"dashboard__bottom__graph",children:[Object($.jsx)("h2",{children:"Status"}),Object($.jsxs)("div",{className:"dashboard__botton__graph__status",children:[" ","We have won the race for our target auction, we are therefore not taking any more contributions. Thanks for all of your support!",Object($.jsx)("br",{}),Object($.jsx)("br",{}),"Learn more "," ",Object($.jsxs)("a",{className:"small-link",href:"https://docs.hydradx.io/hydradx_crowdloan",rel:"noreferrer",target:"_blank",children:[" ","here"]}),".",Object($.jsx)("div",{className:"small-link-wrapper"})]}),Object($.jsx)("div",{className:"charts",children:Object($.jsxs)("div",{className:"target chart",children:[Object($.jsx)("div",{style:{height:(parseFloat(k())>100?100:k())+"%"},className:"barChart"}),Object($.jsxs)("div",{className:"barChartNumber",children:[G()(parseFloat(X((null===v||void 0===v?void 0:v.fundsPledged)||"0")))," ","/"," ",G()(parseFloat("2100000"))," ","DOT TARGET"]})]})})]}),Object($.jsx)("div",{className:"dashboard__bottom__form",children:Object($.jsx)(ae,{totalContributionAmount:p,totalRewards:f,onContribute:S,apiReady:!!a,activeAccount:c,setShowAccountSelector:N,contributionStatus:y,incentive:h})})]})]})]})};var ce=a(180),oe=a(182);const ie=new ce.a({uri:m.processorUrl,cache:new oe.a});var re=function(){return Object($.jsx)(r.a,{client:ie,children:Object($.jsx)(D,{children:Object($.jsx)(k,{children:Object($.jsx)(T,{children:Object($.jsx)(ne,{})})})})})};var le=e=>{e&&e instanceof Function&&a.e(3).then(a.bind(null,186)).then((t=>{let{getCLS:a,getFID:n,getFCP:c,getLCP:o,getTTFB:i}=t;a(e),n(e),c(e),o(e),i(e)}))};let se=(()=>{let e=new URL(document.location).searchParams;return console.log("loglevel",e.get("loglevel")),e.get("loglevel")})()||"info";j.a.setLevel(se),i.a.render(Object($.jsx)(c.a.StrictMode,{children:Object($.jsx)(re,{})}),document.getElementById("root")),le()}},[[150,1,2]]]);
//# sourceMappingURL=main.e8f72725.chunk.js.map